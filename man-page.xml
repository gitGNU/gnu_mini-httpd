<!DOCTYPE refentry PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
  "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd"
  [ <!ENTITY httpd "<application>mini-httpd</application>">
  ]>

<refentry lang="en">
  <refentryinfo>
    <productname>mini-httpd</productname>
    <author>
      <firstname>Peter</firstname>
      <surname>Simons</surname>
      <authorblurb><simpara><ulink url="http://cryp.to/">http://cryp.to/</ulink></simpara></authorblurb>
      <email>simons@cryp.to</email>
    </author>
  </refentryinfo>
  <refmeta>
    <refentrytitle>httpd</refentrytitle>
    <manvolnum>8</manvolnum>
    <refmiscinfo class="manual">Network Daemon</refmiscinfo>
  </refmeta>
  <refnamediv>
    <refname>httpd</refname>
    <refpurpose>a minimalistic high-performance web server</refpurpose>
  </refnamediv>

  <!--==================== Synopsis ====================-->

  <refsynopsisdiv>
    <cmdsynopsis>
      <command>httpd</command>
      <group>
        <arg choice="opt">-h</arg>
        <arg choice="opt">--help</arg>
      </group>
      <arg choice="opt">--version</arg>
      <group>
        <arg choice="opt">-d</arg>
        <arg choice="opt">--debug</arg>
      </group>
      <group>
        <arg choice="opt">-p <replaceable>number</replaceable></arg>
      <arg choice="opt">--port <replaceable>number</replaceable></arg>
      </group>
      <group>
        <arg choice="opt">-r <replaceable>path</replaceable></arg>
        <arg choice="opt">--change-root <replaceable>path</replaceable></arg>
      </group>
      <arg choice="opt">--document-root <replaceable>path</replaceable></arg>
      <group>
        <arg choice="opt">-l <replaceable>path</replaceable></arg>
        <arg choice="opt">--logfile-directory <replaceable>path</replaceable></arg>
      </group>
      <group>
        <arg choice="opt">-s <replaceable>string</replaceable></arg>
        <arg choice="opt">--server-string <replaceable>string</replaceable></arg>
      </group>
      <group>
        <arg choice="opt">-u <replaceable>uid</replaceable></arg>
        <arg choice="opt">--uid <replaceable>uid</replaceable></arg>
    </group>
      <group>
        <arg choice="opt">-g <replaceable>gid</replaceable></arg>
        <arg choice="opt">--gid <replaceable>gid</replaceable></arg>
      </group>
      <arg choice="opt">--default-page <replaceable>filename</replaceable></arg>
      <group>
        <arg choice="opt">-D</arg>
        <arg choice="opt">--no-detach</arg>
      </group>
      <group>
        <arg choice="opt">-H <replaceable>string</replaceable></arg>
        <arg choice="opt">--default-hostname <replaceable>string</replaceable></arg>
      </group>
    </cmdsynopsis>
  </refsynopsisdiv>

  <!--==================== Description ====================-->

  <refsect1>
    <title>Description</title>

    <para>&httpd; is a mini-malistic web server designed for optimal performance,
high security, and as little use of system resources as possible. Unlike most
other web servers, &httpd; does not require more than one process or system
thread in order to handle several requests concurrently. Instead, it uses the
<citerefentry> <refentrytitle>poll</refentrytitle> <manvolnum>2</manvolnum>
</citerefentry> system call to multiplex an arbitrary number of connections
internally.</para>

    <para>The downside is, of course, that &httpd; has zero fancy features.
All it can do is hand out static files from the hard disk. There is no support
for CGI scripts or any kind of dynamic content. If you need a more sophisticated
set-up, this software is not for you. If you really, really need additional
features, well, you have the source code.</para>

    <para>In brief, here is an overview of what &httpd; <emphasis>can</emphasis>
do:</para>

    <orderedlist>
      <listitem>
        <para>HTTP1/1 compliant <quote>keep-connection</quote> support</para>
      </listitem>
      <listitem>
        <para>Virtual hosting</para>
      </listitem>
      <listitem>
        <para>Record successful requests in the common Apache-style log-file format</para>
      </listitem>
      <listitem>
        <para>Run in a <citerefentry> <refentrytitle>chroot</refentrytitle>
<manvolnum>2</manvolnum> </citerefentry> sandbox</para>
      </listitem>
      <listitem>
        <para>Drop all super-user privileges after acquiring the listening socket</para>
      </listitem>
    </orderedlist>

    <para>Furthermore, &httpd; is configured completely through the command
line, there is <emphasis>no</emphasis> config file. For further details on how
to set-up the web server, refer to the section <quote>Setting &httpd; up</quote>
section below.</para>
  </refsect1>

  <!--==================== Command-line Options ====================-->

  <refsect1>
    <title>Command-line Options</title>

    <variablelist>
      <varlistentry>
        <term><option>-h</option></term>
        <listitem>
          <para>Show command line syntax and exit.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><option>-d</option></term>
        <term><option>--debug</option></term>
        <listitem>
          <para>Enable additional debugging messages. Debugging is only
available if &httpd; has been compiled with the <option>--with-debug</option>
configure option. Otherwise, the debug messages are not included in the
binary.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><option>--version</option></term>
        <listitem>
          <para>Show &httpd;'s version string and exit.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><option>-p <replaceable>number</replaceable></option></term>
        <term><option>--port <replaceable>number</replaceable></option></term>
        <listitem>
          <para>Tell &httpd; on which port to listen for incoming requests. The
default port number is <literal>80</literal>.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><option>-r <replaceable>path</replaceable></option></term>
        <term><option>--change-root <replaceable>path</replaceable></option></term>
        <listitem>
          <para>When started with super-user privileges, &httpd; will
<citerefentry> <refentrytitle>chroot</refentrytitle> <manvolnum>2</manvolnum>
</citerefentry> to the directory provided with this option. Please note that
once the process's root directory has been changed, all other paths are
interpreted relative to the <emphasis>new</emphasis> root directory! If you
specify <option>-r /usr/local/mini-httpd</option>, for example, the document
root <filename>/usr/local/httpd/htdocs</filename> has to be given as
<filename>/htdocs</filename>. Keep that in mind when specifying the other
paths!</para>

          <para>The default <function>chroot</function>-directory is the
<varname>prefix</varname> provided to <command>configure</command> when &httpd;
was built. Usually, that is <filename>/usr/local/mini-httpd</filename>.</para>

          <para>If you want to disable <function>chroot()</function>ing
altogether, provide the empty string: <option>-r ""</option>. This is not
recommended, however.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><option>--document-root <replaceable>path</replaceable></option></term>
        <listitem>
          <para>This option sets the document root directory. When an access to,
say, <literal>http://example.org/index.html</literal> comes in, &httpd; will try
to access the file <filename>example.org/index.html</filename> in this
directory. Note that hostnames must be spelled in all lower-case in the file
system!</para>

          <para>The default location is <filename>/htdocs</filename>.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><option>-l <replaceable>path</replaceable></option></term>
        <term><option>--logfile-directory <replaceable>path</replaceable></option></term>
        <listitem>
          <para>This option sets the directory &httpd; uses to create the
access-log files. In this directory, one file per hostname will be created. The
default location is <filename>/logs</filename>.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><option>-s <replaceable>string</replaceable></option></term>
        <term><option>--server-string <replaceable>string</replaceable></option></term>
        <listitem>
          <para>This option sets the version string &httpd; returns with the
<literal>Server:</literal> header in HTTP replies. The default string is
<quote>mini-httpd</quote> -- no actual version number is revealed. If you want
to disable the <literal>Server:</literal> header altogether, specify the empty
string: <option>-s ""</option>.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><option>-u <replaceable>uid</replaceable></option></term>
        <term><option>--uid <replaceable>uid</replaceable></option></term>
        <listitem>
          <para>This option sets the <emphasis>numeric</emphasis> user id
&httpd; will <function>setuid()</function> to when called with super-user
privileges. This is necessary because &httpd; must be started as
<literal>root</literal> in order to be able to <function>bind()</function> to
port 80. But you don't want the server to run as <literal>root</literal> the
whole time! A good choice is usually user id <quote>2</quote>
(<literal>daemon</literal>). If this option is unset, &httpd; will continue to
use the user id is has been started under.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><option>-g <replaceable>uid</replaceable></option></term>
        <term><option>--gid <replaceable>uid</replaceable></option></term>
        <listitem>
          <para>This option sets the <emphasis>numeric</emphasis> group id
&httpd; will <function>setgid()</function> to when called with super-user
privileges. (See <option>--uid</option> for further details.)</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><option>--default-page <replaceable>filename</replaceable></option></term>
        <listitem>
          <para>This option sets the filename &httpd; accesses when a request
for a directory is received. The default is <filename>index.html</filename>.
This means, that a request for <literal>http://example.org/</literal> will
result in the file <filename>example.org/index.html</filename> being
returned.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><option>-D</option></term>
        <term><option>--no-detach</option></term>
        <listitem>
          <para>This option tells &httpd; not to detach from the controlling
terminal, but to run in the foreground. This is useful mostly for debugging
purposes. The default is to detach.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><option>-H <replaceable>string</replaceable></option></term>
        <term><option>--default-hostname <replaceable>string</replaceable></option></term>
        <listitem>
          <para>This option sets default hostname &httpd; uses when a
pre-HTTP/1.1 request comes in, which does not provide the
<literal>Host:</literal> header. If the default hostname is empty or this option
is omitted, &httpd; will reject such requests.</para>
        </listitem>
      </varlistentry>
    </variablelist>
  </refsect1>

  <!--==================== Setup ====================-->

  <refsect1 id="setup">
    <title>Setting &httpd; up</title>

      <para>Setting &httpd; up is pretty easy, because the program does have the
least possible set of features. It may look weird at first, especially if you
know other web servers like <application>Apache</application>, but it's really
not that difficult. The following instructions assume you've installed &httpd;
using the default prefix, <filename>/usr/local/mini-httpd</filename>. Not that
it matters much, though, because you can set all paths at the command
line.</para>

      <para>It's important to understand that &httpd; changes the process's root
directory to <filename>/usr/local/mini-httpd</filename> once it has initialized
its internals. Thus, <emphasis>all</emphasis> files related to your web service
must reside within this directory (or below). You cannot symlink to some path
outside that hierarchy, or some thing.</para>

      <para>First of all, choose an user id you'll run &httpd; under. A sensible
choice is <literal>daemon</literal>, but you can as well use
<literal>nobody</literal> or any other user id you see fit. Find out which
numeric user id this user has on your system by calling the <citerefentry>
<refentrytitle>id</refentrytitle> <manvolnum>1</manvolnum> </citerefentry>
command:</para>

      <informalexample>
        <screen><computeroutput>$</computeroutput> <userinput>id daemon</userinput>
<computeroutput>uid=2(daemon) gid=2(daemon) groups=2(daemon),1(bin)</computeroutput></screen>
      </informalexample>

    <para>Now you'll need to create two directories in
<filename>/usr/local/mini-httpd</filename>: <filename>htdocs</filename> and
<filename>logs</filename>. The first directory will contain the actual web
documents in one subdirectory per (virtual) host you want to provide. The second
directory will contain the access logs written by &httpd;. Consequently,
&httpd;'s user must be allowed to read <filename>htdocs</filename> and to write
to <filename>logs</filename>. The following commands will ensure that:</para>

      <informalexample>
        <screen># mkdir htdocs logs
# chown daemon.daemon htdocs logs</screen>
      </informalexample>

      <para>Now create a directory in <filename>htdocs</filename>, which is
called like the hostname, your web service should be provided under. Make sure
you use all lower-case characters! If your web server is accessed as, say,
<literal>example.com</literal> and <literal>www.example.com</literal>, do the
following:</para>

      <informalexample>
        <screen># mkdir htdocs/example.org
# ln -s htdocs/example.org htdocs/www.example.org
# chown daemon.daemon htdocs/example.org htdocs/www.example.org</screen>
      </informalexample>

      <para>If you're unsure what hostname to use for testing purposes,
<literal>localhost</literal> is usually a safe bet. :-)</para>

      <para>Copy the HTML documents to the
<filename>htdocs/example.org</filename> directory and ensure that &httpd; has
permission to access them! Finally, start &httpd; as <literal>root</literal>,
using the following command line:</para>

      <informalexample>
        <screen># /usr/local/mini-httpd/bin/httpd --uid 2</screen>
      </informalexample>

      <para>That's it. You may now direct your favorite browser to
<literal>http://example.org/</literal> and see what happens.</para>

      <para>In case you want to try &httpd; with some port other than 80, add
the <option>--port</option> option to the command line: <option>--port
8080</option>. Furthermore, you might want to add the <option>--debug</option>
switch to turn on the debugging messages in &httpd;. That is particularly
helpful in case &httpd; is not behaving as you're expecting.</para>

      <para>Once you have accessed the web site, you'll find the appropriate
access-log file in the <filename>logs</filename> directory; one file per virtual
host.</para>

      <para>If you want to add more virtual hosts to &httpd;, just create the
corresponding directory in <filename>htdocs</filename>.</para>

  </refsect1>

  <!--==================== License ====================-->

  <refsect1>
    <title>License</title>

    <para>This program is free software: you can redistribute it and/or
    modify it under the terms of the GNU General Public License as
    published by the Free Software Foundation, either version 3 of the
    License, or (at your option) any later version.</para>

    <para>This program is distributed in the hope that it will be
    useful, but WITHOUT ANY WARRANTY; without even the implied warranty
    of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
    General Public License for more details.</para>

    <para>You should have received a copy of the GNU General Public
    License along with this program. If not, see <ulink
    url="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</ulink>.</para>
  </refsect1>

</refentry>
